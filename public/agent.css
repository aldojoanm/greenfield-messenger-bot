:root{
  color-scheme: light;
  --bg:#f5f6f7;
  --panel:#ffffff;
  --panel-2:#f0f2f5;
  --ink:#0b141a;
  --muted:#6b7b85;
  --muted-2:#7f8f98;
  --accent:#00a884;
  --ok-bg:#ccf5e5;
  --ok-ink:#075e54;

  --topbar-h:56px; --chatbar-h:56px; --composer-min-h:66px;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  background:var(--bg);
  color:var(--ink);
  font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overscroll-behavior-y:none;
  -webkit-text-size-adjust:100%;
}
.app{min-height:100svh;display:block}  /* evita ‘salto’ del composer en móvil */
.only-mobile{display:none} .only-desktop{display:inline}
.safe-top{padding-top:var(--topbar-h)}

.pill{display:inline-block;padding:.2rem .5rem;border-radius:999px;background:var(--ok-bg);color:var(--ok-ink);font-weight:700}
.btn,.icon-btn{background:var(--panel-2);color:var(--ink);border:1px solid rgba(0,0,0,.08);border-radius:6px;padding:.35rem .6rem;cursor:pointer;white-space:nowrap}

/* Topbar */
.topbar{
  position:fixed;inset:0 0 auto 0;height:var(--topbar-h);z-index:50;
  display:flex;align-items:center;gap:.75rem;padding:0 .75rem;
  border-bottom:1px solid rgba(0,0,0,.07);background:var(--panel)
}
.topbar h1{margin:0;font-size:16px;font-weight:600}
.standalone .topbar{padding-top:calc(.25rem + var(--safe-top));height:calc(var(--topbar-h) + var(--safe-top))}

/* Filtros/lista */
.filters{padding:.5rem .75rem;border-bottom:1px solid rgba(0,0,0,.06);background:var(--panel)}
.filters-row{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
.count{color:var(--muted)}
.segmented{display:flex;gap:.5rem;flex-wrap:wrap;min-width:min(100%,720px)}
.seg{background:var(--panel-2);border:1px solid transparent;color:#56636c;padding:.35rem .6rem;border-radius:999px;cursor:pointer;white-space:nowrap}
.seg.active{background:#d9fdd3;color:#1f3c2f;border-color:#9be1b5}
.searchbar{display:flex;align-items:center;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}
.searchbar input{background:#fff;border:1px solid rgba(0,0,0,.10);color:var(--ink);padding:.45rem .65rem;border-radius:6px;min-width:220px;flex:1 1 220px;font-size:16px}
.datebar{display:flex;gap:.5rem;align-items:center;margin-top:.5rem;flex-wrap:wrap}
.datebar label{display:flex;gap:.35rem;align-items:center;color:#4c5a63;font-size:13px}

/* Lista */
.view{height:auto}
.threads{display:flex;flex-direction:column}
.thread{
  display:grid;grid-template-columns:44px 1fr auto;gap:.75rem;
  padding:.6rem .75rem;align-items:center;border-bottom:1px solid rgba(0,0,0,.06);cursor:pointer;background:transparent
}
.thread:hover{background:rgba(0,0,0,.03)}
.avatar{width:44px;height:44px;border-radius:50%;overflow:hidden;display:grid;place-items:center;background:var(--panel-2)}
.avatar img{width:100%;height:100%;object-fit:cover}
.avatar span{font-weight:700;color:var(--muted)}
.t-main{min-width:0}
.t-row1{display:flex;align-items:center;justify-content:space-between;gap:.5rem}
.t-name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.t-time{color:#73838f;white-space:nowrap}
.t-last{color:var(--muted-2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dot{width:10px;height:10px;border-radius:50%}
.dot.unread{background:var(--accent)} .dot.done{background:#bfc9cf} .dot.agent{background:#f5a623}

/* Chat */
.view-chat{display:flex;flex-direction:column}
.chatbar{display:flex;align-items:center;gap:.75rem;padding:.6rem .75rem;border-bottom:1px solid rgba(0,0,0,.06);background:var(--panel);z-index:3}
.chat-title{display:flex;flex-direction:column;gap:.25rem}
.name{font-weight:700} .meta{color:var(--muted);font-size:12px}

/* Mensajes */
.msgs{
  padding:.75rem;
  display:flex;flex-direction:column;gap:.5rem;
  overflow:auto;background:transparent;min-height:200px;flex:1 1 auto;
  -webkit-overflow-scrolling:touch; overscroll-behavior:contain;
}
.bubble{max-width:min(65ch,72%);padding:.6rem .7rem;border-radius:14px;word-break:break-word;overflow-wrap:anywhere;border:1px solid rgba(0,0,0,.06)}
.bubble.user{align-self:flex-start;background:var(--panel-2)}
.bubble.bot{align-self:flex-end;background:#d9fdd3;border-color:#b3e8c5}
.bubble.agent{align-self:flex-end;background:#e6ebef;border-color:#cfd7dc}
.bubble.sys{align-self:center;background:#e9eef2;color:#51606a;border-color:rgba(0,0,0,.06)}

/* Composer (solo lado chat) */
.composer{
  position:fixed; left:0; right:0; bottom:0; z-index:6;
  border-top:1px solid rgba(0,0,0,.06); background:var(--panel);
}
.composer-inner{
  display:grid; grid-template-columns:auto 1fr auto; gap:.4rem;
  padding:.5rem .75rem calc(.5rem + var(--safe-bottom));
  align-items:center;
  width:min(820px, 100%); margin:0 auto;   /* Limita ancho y centra */
}
.more-btn{
  appearance:none; border:none; background:transparent; color:#5f6b73;
  width:44px; height:44px; border-radius:12px; display:grid; place-items:center;
}
#box{
  width:100%; resize:none; min-height:40px; max-height:160px; /* más compacto */
  padding:.5rem .7rem; border-radius:20px;
  background:#fff; color:var(--ink);
  border:1px solid rgba(0,0,0,.10); font-size:16px; line-height:1.15;
}
.send-btn{appearance:none; border:none; background:transparent; width:44px; height:44px; display:grid; place-items:center; padding:0}
.send-btn img{width:22px;height:22px;display:block}

/* Panel de acciones: gris en móvil, tarjeta blanca en desktop */
.action-panel{
  position:fixed; left:0; right:0; bottom:calc(var(--composer-min-h) + var(--safe-bottom) + 6px);
  background:#2a2f34; color:#fff; z-index:5;
  display:none; padding:16px 12px 20px;
  border-top:1px solid rgba(255,255,255,.08);
  box-shadow:0 -10px 24px rgba(0,0,0,.25);
}
.action-panel.show{display:block}
.ap-grid{
  width:100%; max-width:460px; margin:0 auto;
  display:grid; grid-template-columns:repeat(3, 1fr); gap:22px 28px; justify-items:center;
}
.ap-item{background:transparent;border:0;cursor:pointer;color:#fff;text-align:center}
.ap-circle{
  width:60px;height:60px;border-radius:50%;display:grid;place-items:center;
  background:#394046; border:1px solid rgba(255,255,255,.08);
}
.ap-circle img{width:26px;height:26px;display:block}
.ap-label{display:block;margin-top:8px;font-size:13px}

@media (min-width:1024px){
  .app{display:grid;grid-template-columns:380px 1fr;height:100dvh;overflow:hidden}
  .view-list{display:block;height:calc(100dvh - var(--topbar-h));overflow:hidden;margin-top:var(--topbar-h)}
  .view-chat{
    border-left:1px solid rgba(0,0,0,.10);
    margin-top:var(--topbar-h);
    height:calc(100dvh - var(--topbar-h));
    display:grid;grid-template-rows: var(--chatbar-h) 1fr;overflow:hidden;background:var(--panel)
  }
  .view-chat .msgs{position:relative;padding:.75rem;overflow:auto;background:var(--bg)}
  .bubble{max-width:min(60ch,52%)}

  /* El panel en desktop se vuelve tarjeta blanca centrada */
  .action-panel{
    background:#fff; color:var(--ink);
    border:1px solid rgba(0,0,0,.12);
    border-radius:16px;
    bottom:calc(var(--composer-min-h) + 12px);
    width:560px; left:50%; transform:translateX(-50%);
    box-shadow:0 14px 46px rgba(0,0,0,.18);
    padding:14px 16px 18px;
  }
  .ap-label{ color:#44525c; }
  .ap-circle{ background:#f7f9fa; border:1px solid rgba(0,0,0,.06); }
}

/* Móvil */
@media (max-width:1023px){
  .only-mobile{display:inline} .only-desktop{display:none}
  .view{display:none} .view.active{display:block}
  .topbar{position:static;width:100%}
  .standalone .topbar{padding-top:calc(.25rem + var(--safe-top));height:calc(var(--topbar-h) + var(--safe-top))}
  .safe-top{padding-top:0}
  .view-chat .chatbar{position:sticky;top:0;padding-top:calc(.25rem + var(--safe-top));z-index:4;transform:translateZ(0)}
  .view-chat .msgs{
    padding-bottom:calc(var(--composer-min-h) + var(--safe-bottom) + 16px);
    max-height:none; background:var(--bg);
  }
}

/* Drag&drop */
.drag{outline:2px dashed rgba(0,0,0,.20);outline-offset:-6px}
.seg{white-space:nowrap}

/* Oculta fila de acciones legacy en desktop si existiera */
.sheet-row{ display:none !important; }
